---
layout: indexed
title: CADAL 下載入門篇
date: '2014/07/23'
---
h2. CADAL 簡介

別的不用知道，反正記住， CADAL 是中國和美國聯合投入一些納稅人的錢做成的，有數以百萬計 2005 年之前出版的書和論文。書籍以 DjVu 格式存儲，淸晰度還可以。 CADAL 曾向社會公衆開放，但現在關了，僅供若干高校閱讀，但是衹要掌握規律，任何人都可以下載一部分 CADAL 書籍——但這裏介紹的方法衹能用於下載部分書籍，主要是一些民國書和古籍——剛好就是 CADAL 的強項。
相比起來， CADAL 有這些優勢：首先，掃描的分辨率高達 600dpi ，是業界最高的；其次，除了部分特殊情況，他的書沒有水印，而且衹要能下載，全書都是 300dpi 的，沒有超星那樣愛耍小心計； CADAL 比較肯用心，所以書籍有書籤的機率比較大，卽使不下載 CADAL 的書，也可以在他這裏下載書籤；最重要的是，儘管多數書籍重疊，但 CADAL 還是有不少獨有書籍的，也是網絡上一個很重要的電子書來源，可以說，掌握了超星和 CADAL ，就掌握了 95% 的中文電子書。
本文以一部叫「<a href="http://www.cadal.zju.edu.cn/book/03000729" rel="external">莊子天下篇講疏</a>」的書爲例，解釋如何下載。

h2. 高校 IP

哼，沒上過北大，難道還不能上北大的代理？
不過我上過兩個南大，卻沒上過任何一個南大的代理……
趕快找論壇搞個帳號罷！提示：本站某頁面，就有通向四個很多這種帳號的論壇的鏈接。文明的讀書人不要偷看人家郵件，更不要改密碼！

h2. 下載

h3. 提取書號 `BookNum`

搜索所要書籍，「閱讀」是個形如 http://www.cadal.zju.edu.cn/book/03000729 的鏈接，最後的八位數字就是書號。在這個例子當中，八位書號 `BookNum` 就是 `03000729` 。

h3. 判定書籍類別 `BookType`

CADAL 內部將書籍分成以下幾種：
古籍 `anc`
民國圖書 `minguo`
民國期刊 `minguoqikan`
期刊 `qikan`
現代圖書 `book`
敦煌古籍 `dunhuang`
英文 `eng`
學位論文 `deg`
書法 `shufa`

這本書的類別顯然是民國圖書，也就是 `minguo` 。公衆可以多猜幾次，如果擁有高校 IP ，可以先註冊一個免費帳號，然後進入閱讀頁面，使用 Firebug 之類的瀏覽器插件看網頁源代碼，裏面有個叫 `BookType` 的參數，就是這本書的內部分類了。

h3. 獲取書籍頁碼 `TotalPage`

公衆需要猜測一個大於書籍總頁數的數字，擁有高校 IP 則可以在網頁源代碼中找到 `TotalPage` 參數。
莊子天下篇講疏一共有 `161` 頁。

h3. 構造眞實鏈接

好了，現在我們要找出眞實鏈接了。事實上，這本書的眞實鏈接是：
http://210.32.137.91/dlib5/ebooks/minguo/03/001000/03000729/ptiff/00000001.djvu
http://210.32.137.91/dlib5/ebooks/minguo/03/001000/03000729/ptiff/00000002.djvu
......
http://210.32.137.91/dlib5/ebooks/minguo/03/001000/03000729/ptiff/00000161.djvu
是的， CADAL 和超星一樣，每頁一個文件。
那麼規律是什麼呢？
`http://210.32.137.91/` 這一串基本上是固定的。
`dlib5/ebooks` 這個 `dlib5` 從 `dlib` 開始，接着是 `dlib2`, `dlib3`, `dlib4`, `dlib5`, `dlib6` ，之後是 `newebooks7`, `newebooks8`, `newebooks9`, `newebooks10`, `newebooks11`
`ebooks` 不變。
`minguo` 就是 `BookType` 參數。
`03/001000/03000729` 看起來有點複雜，其實 `03000729` 就是之前獲取的 `BookNum` ， `03` 是 `BookNum` 的前二位， `001000` 是 `BookNum` 的第 3-5位 加 1 ，後面添上 000 。
`ptiff` 不變
`00000161` 之類的，是八位數字，從 1 一直到 `TotalPage` 。
構建好鏈接後，用第一頁逐一放進瀏覽器或用 FlashGet 批量測試，如果能下載 djvu ，就是眞實地址，可應用於全書頁面。
由於 `dlib` 比較多可能性， `BookType` 也可能搞錯，還是需要試挺多次的。

h3. 批量下載鏈接

要一個個下？沒那麼煩。
用 FlashGet ，任務-添加成批任務-把鏈接改成形如 http://210.32.137.91/dlib5/ebooks/minguo/03/001000/03000729/ptiff/(*).djvu 的，選擇 `8` 位，塡上從 `1` 到 `TotalPage` 搞定。

h3. 下載書籤

有的書會有書籤。將鏈接改動一下就是書籤的地址了。
http://210.32.137.91/dlib5/ebooks/minguo/03/001000/03000729/meta/Catalog.xml

h2. 整理

個人認爲整理是比較重要的，因爲下載了一堆散碎的文件，分散着放對硬盤不好，剪切複製速度慢，還容易亂。因而主要有兩種整理方式：改名爲 pdg 並打包，以及合倂爲一個大的 DjVu 文件。
當然還可以把他轉成 PDF 或者某圖片格式，不過我就不討論了。

h3. 合倂

合倂很簡單，目前最方便還是用 `DjVuToy` 。
合倂的缺點是，合倂後的文件如果比較大打開起來就會慢一些，而且畢竟是破壞了下載到的文件。

h3. 打包 pdg

首先有 `TotalCMD` 之類的工具，批量將 8 位文件名轉成 6 位，並把擴展名改成 pdg 。
然後按文件夾打包 zip 就行了。這個過程中可以把 `Catalog.xml` 書籤轉成超星模式掛上去。