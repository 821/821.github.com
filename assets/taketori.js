var TaketoriDblClickAlert={"ja-jp":"\uFEFF\u7E26\u66F8\u304D\u5316\u3057\u305F\u3044\u90E8\u5206\u3092\u30C0\u30D6\u30EB\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u304F\u3060\u3055\u3044\u3002","zh-tw":"\u9ede\u5169\u4e0b\u4ee5\u5207\u63db\u5230\u76f4\u6392\u986f\u793a\u3002","zh-cn":"Double click to make text vertical.","ko-kr":"Double click to make text vertical."};var TaketoriDefaultLang=(document.getElementsByTagName("html")[0]&&document.getElementsByTagName("html")[0].lang)?(document.getElementsByTagName("html")[0].lang.search(/tw/i)!=-1)?"zh-tw":"ja-jp":"ja-jp";var TaketoriTool=function(){};TaketoriTool.prototype={element:function(a){if(arguments.length>1){a=Array.prototype.slice.call(arguments)}this.elements=new Array();return this.appendElement(a)},list:function(){return(this.elements)?this.elements:[]},appendElement:function(d){if(arguments.length>1){d=Array.prototype.slice.call(arguments)}if(!d){return this}if(!this.elements){this.elements=new Array()}if(d.constructor==Array){for(var c=0;c<d.length;c++){this.appendElement(d[c])}}else{if(typeof d=="object"){if(!this.isIncluded(d)){this.elements[this.elements.length]=d}}else{if(typeof d=="string"){if(d.match(/^(\w+)\.([\w\-]+)$/)){var b=RegExp.$1.toLowerCase();var a=RegExp.$2;var f=new Array();if(typeof document.getElementsByClassName=="function"){f=document.getElementsByClassName(a);for(var c=0;c<f.length;c++){if(f[c].tagName.toLowerCase()==b&&!this.isIncluded(f[c])){this.elements[this.elements.length]=f[c]}}}if(typeof document.getElementsByClassName!="function"||f.length==0){f=document.getElementsByTagName(b);var e=new RegExp("(^|\\s)"+a+"(?![\\w\\-])");for(var c=0;c<f.length;c++){if(f[c].className.search(e)!=-1&&!this.isIncluded(f[c])){this.elements[this.elements.length]=f[c]}}}}else{d=document.getElementById(d.replace("#",""));if(d&&!this.isIncluded(d)){this.elements[this.elements.length]=d}}}}}return this},isIncluded:function(b){for(var a=0;a<this.elements.length;a++){if(this.elements[a]==b){return true}}return false},removeClassName:function(a){return this.replaceClassName(a,"","ig")},replaceClassName:function(a,c,b){if(this.elements&&a!=null&&a!=""){var e=new RegExp("(^|\\s)"+a+"(?![\\w\\-])",b);if(c==null){c=""}for(var d=0;d<this.elements.length;d++){if(this.elements[d].className!=null){this.elements[d].className=this.elements[d].className.replace(e,c)}}}return this},addClassName:function(a){if(this.elements&&a!=null&&a!=""){var c=new RegExp("(^|\\s)"+a+"(?![\\w\\-])");for(var b=0;b<this.elements.length;b++){if(this.elements[b].className==null||this.elements[b].className==""){this.elements[b].className=a}else{if(this.elements[b].className.search(c)==-1){this.elements[b].className+=" "+a}}}}return this},addEventListener:function(c,d,a){if(a==null){a=false}if(this.elements){for(var b=0;b<this.elements.length;b++){if(typeof this.elements[b].addEventListener=="function"){this.elements[b].addEventListener(c,d,a)}else{if(typeof this.elements[b].attachEvent=="object"){this.elements[b].attachEvent("on"+c,d)}}}}return d},removeEventListener:function(c,d,a){if(this.elements){for(var b=0;b<this.elements.length;b++){if(typeof this.elements[b].removeEventListener=="function"){this.elements[b].removeEventListener(c,d,a)}else{if(this.elements[b].detachEvent){this.elements[b].detachEvent("on"+c,d)}}}}},stopPropagation:function(a){if(a.stopPropagation){a.stopPropagation()}else{event.cancelBubble=true}},preventDefault:function(a){if(a.preventDefault){a.preventDefault()}else{event.returnValue=false}}};var Taketori=function(){};Taketori.prototype={isMSIE:((navigator.appVersion.search(/MSIE/)!=-1)?((document.documentMode)?document.documentMode:5):0),isWritingModeReady:((navigator.appVersion.search(/MSIE/)!=-1||typeof(document.createElement("div")).style.MozWritingMode!="undefined"||typeof(document.createElement("div")).style.webkitWritingMode!="undefined"||typeof(document.createElement("div")).style.OWritingMode!="undefined")?true:false),isMultiColumnReady:((typeof(document.createElement("div")).style.MozColumnWidth!="undefined"||typeof(document.createElement("div")).style.webkitColumnWidth!="undefined"||(typeof(document.createElement("div")).style.webkitWritingMode!="undefined"&&typeof(document.createElement("div")).style.webkitColumnWidth!="undefined")||typeof(document.createElement("div")).style.OColumnWidth!="undefined"||typeof(document.createElement("div")).style.msColumnWidth!="undefined"||typeof(document.createElement("div")).style.columnWidth!="undefined")?true:false),isLegacy:((navigator.appVersion.search(/MSIE/)!=-1||typeof(document.createElement("div")).style.MozTransform!="undefined"||typeof(document.createElement("div")).style.webkitTransform!="undefined"||typeof(document.createElement("div")).style.OTransform!="undefined"||typeof(document.createElement("div")).style.transform!="undefined")?false:true),isTextEmphasisReady:((typeof(document.createElement("div")).style.MozTextEmphasisStyle!="undefined"||typeof(document.createElement("div")).style.webkitTextEmphasisStyle!="undefined"||typeof(document.createElement("div")).style.OTextEmphasisStyle!="undefined"||typeof(document.createElement("div")).style.msTextEmphasisStyle!="undefined"||typeof(document.createElement("div")).style.textEmphasisStyle!="undefined")?true:false),document:(new TaketoriTool()),importCSS:function(){var d=false;var c=false;var b=document.getElementsByTagName("link");for(var e=0;e<b.length;e++){if(b[e].href!=null&&b[e].href.search(/taketori\.css$/)!=-1){d=true}}if(d){return true}if(this.config.cssPath==null||this.config.cssPath=="auto"){var a=document.getElementsByTagName("script");for(var e=0;e<a.length;e++){if(a[e].src!=null&&a[e].src.search(/taketori\.js$/)!=-1){this.config.cssPath=a[e].src.replace("taketori.js","");break}}}var g=document.getElementsByTagName("head")[0];if(g){var f;f=document.createElement("link");f.setAttribute("rel","stylesheet");f.setAttribute("type","text/css");f.setAttribute("href",this.config.cssPath+"taketori.css");g.appendChild(f)}else{document.write('<link rel="stylesheet" type="text/css" href="'+this.config.cssPath+'taketori.css" />')}},setTemporaryCSS:function(a){if(!this.temporaryStyle){this.temporaryStyle=document.createElement("style");this.temporaryStyle.setAttribute("type","text/css");document.getElementsByTagName("head")[0].appendChild(this.temporaryStyle)}this.temporaryStyle.appendChild(document.createTextNode(a))},removeTemporaryCSS:function(){if(this.temporaryStyle){document.getElementsByTagName("head")[0].removeChild(this.temporaryStyle);this.temporaryStyle=null}},init:function(){if(!this.windowWidth){var c=this;this.document.element(window).addEventListener("resize",function(){if(c.resizeTimer){clearTimeout(c.resizeTimer)}c.resizeTimer=setTimeout(function(){c.refresh()},500)})}this.windowWidth=((self.innerWidth)?self.innerWidth:(document.compatMode!=null&&document.compatMode!="BackCompat")?self.document.documentElement.clientWidth:self.document.body.clientWidth);this.windowHeight=((self.innerHeight)?self.innerHeight:(document.compatMode!=null&&document.compatMode!="BackCompat")?self.document.documentElement.clientHeight:self.document.body.clientHeight);if(!this.isMSIE&&this.rubyDisabled==null){if(!!window.opera){this.rubyDisabled=true}else{var a=document.createElement("ruby");var b=this.getStyle(a).display;this.rubyDisabled=(b=="block")?true:false}}},set:function(a){if(this.isLegacy){return this}if(!this.config){this.config={}}if(a!=null){this.merge(this.config,a)}if(this.config.lang){this.config.lang=this.config.lang.toLowerCase()}return this},merge:function(b,c){if(!b){b={}}if(c!=null){for(var a in c){if(c[a]!=null){if(c[a].constructor==Array){this.merge(b[a],c[a])}else{if(typeof c[a]=="string"||typeof c[a]=="number"||typeof c[a]=="boolean"){b[a]=c[a]}}}}}return b},element:function(b){if(this.isLegacy){return this}if(arguments.length>1){b=Array.prototype.slice.call(arguments)}if(!this.config.elements){this.config.elements=new Array()}if(b&&b.constructor==Array){for(var a=0;a<b.length;a++){this.config.elements[this.config.elements.length]=b[a]}}else{if(b){this.config.elements[this.config.elements.length]=b}}return this},reset:function(a){this.config=null;this.set(a)},japaneseReadableElements:function(c){var a=new Array();var g=new Array();var j=document.getElementsByTagName("p");for(var f=0;f<j.length;f++){g[g.length]=j[f]}j=document.getElementsByTagName("br");for(var f=0;f<j.length;f++){g[g.length]=j[f]}for(var f=0;f<g.length;f++){var b=this.lookUpBlockElements(g[f],a);if(b!=null&&!this.isCountedElement(a,b)){var h=b.innerHTML;var d=0;h.replace(/\u3002/g,function(){d++}).replace(/\u3001/g,function(){d+=0.5});a[a.length]={element:b,readabilityScore:d}}}if(a.length>0){a=a.sort(function(k,i){return i.readabilityScore-k.readabilityScore});var e=new Array();for(var f=0;f<a.length;f++){if(!this.isVerticalTextElement(a[f].element)&&(!c||c<a[f].readabilityScore)){e[e.length]=a[f].element}}return e}else{return[document.body]}},isVerticalTextElement:function(a){var b=this.getStyle(a);return((navigator.appVersion.search(/MSIE/)!=-1&&typeof b.writingMode=="string"&&(b.writingMode.toLowerCase()=="tb-rl"||b.writingMode.toLowerCase()=="vertical-rl"))||(typeof b.MozWritingMode=="string"&&b.MozWritingMode.toLowerCase()=="vertical-rl")||(typeof b.webkitWritingMode=="string"&&b.webkitWritingMode.toLowerCase()=="vertical-rl")||(typeof b.OWritingMode=="string"&&b.OWritingMode.toLowerCase()=="vertical-rl")||(typeof b.writingMode=="string"&&b.writingMode.toLowerCase()=="vertical-rl"))?true:false},isCountedElement:function(c,b){for(var a=0;a<c.length;a++){if(c[a].element==b){return true}}return false},lookUpBlockElements:function(b){var c=null;while(b){var a=b.tagName.toLowerCase();if(a=="div"||a=="td"||a=="th"||a=="dd"||a=="section"||a=="article"||a=="body"){if(b.taketori||!c){c=b}if(a=="body"){break}}b=b.parentNode}return c},isIncludedIn:function(c,b){if(c&&c.constructor==Array){for(var a=0;a<c.length;a++){if(c[a]==b){return true}}}return false},escapeHTML:function(b){var c=document.createElement("div");var a=document.createTextNode(b);c.appendChild(a);return c.innerHTML},unescapeHTML:function(a){return(a==null)?"":a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},getCookie:function(b){var e=new Array();var g=document.cookie.split(/;\s*/);for(var d=0;d<g.length;d++){if(g[d]!=""){var a=g[d].indexOf("=");if(a>=0){var c=g[d].substring(0,a);var f=g[d].substring(a+1,g[d].length);e[c]=f}}}return(b!=null&&e[b]!=null)?e[b]:""},setCookie:function(b,c,a){if(!a){if(this.config.cookieExpires){a=this.config.cookieExpires}else{a=new Date();a.setTime(a.getTime()+86400000000)}}document.cookie=b+"="+c+"; expires="+a.toGMTString()+";"+((this.config.cookieDomain!=null&&this.config.cookieDomain!="")?" domain="+this.config.cookieDomain+";":"")+((this.config.cookiePath!=null&&this.config.cookiePath!="")?" path="+this.config.cookiePath:"")},deleteCookie:function(a){this.setCookie(a,"",new Date(70,0,1,0,0,1))},setOnLoad:function(a){if(this.isLegacy){return this}if(typeof window.addEventListener=="function"){window.addEventListener("load",a,false)}else{if(typeof window.attachEvent=="object"){window.attachEvent("onload",((!this.isMultiColumnReady)?function(){setTimeout(a,600)}:a))}}return this},getStyle:function(b){if(b.currentStyle){return b.currentStyle}else{var c=document.defaultView.getComputedStyle(b,null);var d=document.createElement("div");if(c.length){for(var a=0;a<c.length;a++){d.style.setProperty(c[a],c.getPropertyValue(c[a]),"")}for(var a=0;a<b.style.length;a++){d.style.setProperty(b.style[a],b.style.getPropertyValue(b.style[a]),"")}}else{d.style.cssText=c.cssText+b.style.cssText}return d.style}},counterClockwiseRotatedOuterHTML:function(g,d,b){var o;var e=(d.display!="inline"||(d.cssFloat&&d.cssFloat!="none")||(d.styleFloat&&d.styleFloat!="none"))?true:false;var k=false;if(!d){d=this.getStyle(g)}if(b){o=document.createElement("div")}else{o=g.cloneNode(true)}if(this.isWritingModeReady&&b){if(d.width&&d.width.search(/\d+\.?\d*(px|em)/i)!=-1&&parseInt(d.width)>0&&d.height&&d.height.search(/\d+\.?\d*(px|em)/i)!=-1&&parseInt(d.height)>0){if(g.currentStyle||(d.cssFloat&&d.cssFloat!="none")||(d.display=="inline-block")){k=true}else{o.style.width="auto";o.style.height="auto"}}else{if((d.width&&d.width.search(/\d+\.?\d*%/)!=-1)||(d.height&&d.height.search(/\d+\.?\d*%/)!=-1)){o.style.width=(d.height&&d.height.search(/\d+\.?\d*%/)!=-1)?d.height:"auto";o.style.height=(d.width&&d.width.search(/\d+\.?\d*%/)!=-1)?d.width:"auto"}else{if(d.width=="0px"){o.style.width="auto"}if(d.height=="0px"){o.style.height="auto"}}}}if(!this.isWritingModeReady||k||(this.isWritingModeReady&&!b)){var n=0;var l=0;var c=false;if(this.isWritingModeReady){n=this.getMarginSize([d.paddingLeft,d.paddingRight,d.borderLeftWidth,d.borderRightWidth]);l=this.getMarginSize([d.paddingTop,d.paddingBottom,d.borderTopWidth,d.borderBottomWidth]);c=true}else{n=this.getMarginSize([d.paddingTop,d.paddingBottom,d.borderTopWidth,d.borderBottomWidth]);l=this.getMarginSize([d.paddingLeft,d.paddingRight,d.borderLeftWidth,d.borderRightWidth])}var m=(!isNaN(parseInt(d.width))&&parseInt(d.width)>0)?parseInt(d.width):(g.width)?g.width:(g.offsetWidth)?g.offsetWidth-((c)?n:l):null;var j=(!isNaN(parseInt(d.height))&&parseInt(d.height)>0)?parseInt(d.height):(g.height)?g.height:(g.offsetHeight)?g.offsetHeight-((c)?l:n):null;var i=false;if(!m||!j){this.makeClipboard(this.process.target,true);this.clipboard.appendChild(o);m=(o.offsetWidth)?o.offsetWidth-((c)?n:l):o.clientWidth;j=(o.offsetHeight)?o.offsetHeight-((c)?l:n):o.clientHeight;this.clipboard.removeChild(o)}if(!isNaN(m)&&!isNaN(j)){m+=n;j+=l;if(j>this.process.config.height){m=parseInt(m*this.process.config.height/j);j=this.process.config.height;i=true}if(m>this.process.config.width){j=parseInt(j*this.process.config.width/m);m=this.process.config.width;i=true}if(i||k){var f=m-n;var a=j-l;if(k){if(g.currentStyle||(d.display=="inline-block")){o.width=a;o.style.width=a+"px"}else{o.style.width="auto"}o.height=f;o.style.height=f+"px"}else{o.width=f;o.height=a;o.style.width=f+"px";o.style.height=a+"px";if(i&&e){o.style.overflow="auto"}}}}}o.style.borderTopWidth=d.borderLeftWidth||0;o.style.borderRightWidth=d.borderTopWidth||0;o.style.borderBottomWidth=d.borderRightWidth||0;o.style.borderLeftWidth=d.borderBottomWidth||0;o.style.borderTopColor=d.borderLeftColor||"";o.style.borderRightColor=d.borderTopColor||"";o.style.borderBottomColor=d.borderRightColor||"";o.style.borderLeftColor=d.borderBottomColor||"";o.style.borderTopStyle=d.borderLeftStyle||"none";o.style.borderRightStyle=d.borderTopStyle||"none";o.style.borderBottomStyle=d.borderRightStyle||"none";o.style.borderLeftStyle=d.borderBottomStyle||"none";if(e||!b||(this.isWritingModeReady&&(!this.isMSIE||this.isMSIE<8))){o.style.paddingTop=d.paddingLeft||0;o.style.paddingRight=d.paddingTop||0;o.style.paddingBottom=d.paddingRight||0;o.style.paddingLeft=d.paddingBottom||0}if(this.isWritingModeReady){if(e&&b){o.style.overflowX=(d.overflowY)?d.overflowY:"visible";o.style.overflowY=(d.overflowX)?d.overflowX:"visible"}if(d.backgroundPositionX||d.backgroundPositionY){o.style.backgroundPositionX=(d.backgroundPositionY)?(d.backgroundPositionY=="top")?"left":(d.backgroundPositionY=="bottom")?"right":d.backgroundPositionY:"50%";o.style.backgroundPositionY=(d.backgroundPositionX)?(d.backgroundPositionX=="left")?"top":(d.backgroundPositionX=="right")?"bottom":d.backgroundPositionX:"50%"}else{if(d.backgroundPosition&&d.backgroundPosition.search(/(\S+)\s+(\S)/)!=-1){o.style.backgroundPosition=RegExp.$2+" "+RegExp.$1+";"}}if(e||!b||!this.isMSIE||this.isMSIE<8){o.style.marginTop=d.marginLeft||0;o.style.marginRight=d.marginTop||0;o.style.marginBottom=d.marginRight||0;o.style.marginLeft=d.marginBottom||0}}else{o.style.marginTop=parseInt(((d.marginTop&&d.marginTop!="auto")?parseInt(d.marginTop):0)+((m-j)/2))+"px";o.style.marginRight=parseInt(((d.marginRight&&d.marginRight!="auto")?parseInt(d.marginRight):0)+((j-m)/2))+"px";o.style.marginBottom=parseInt(((d.marginBottom&&d.marginBottom!="auto")?parseInt(d.marginBottom):0)+((m-j)/2))+"px";o.style.marginLeft=parseInt(((d.marginLeft&&d.marginLeft!="auto")?parseInt(d.marginLeft):0)+((j-m)/2))+"px";if(d.backgroundPosition&&d.backgroundPosition.search(/(\S+)\s+(\S)/)!=-1){o.style.backgroundPosition=RegExp.$2+" "+RegExp.$1+";"}}return(b)?o.style.cssText+";"+g.style.cssText:this.outerHTML(o)},outerHTML:function(a){if(!a){return""}var b=document.createElement("div");b.appendChild(a.cloneNode(true));return b.innerHTML},rotatedBlockAdditionalCSSText:function(a,b,c,d){if(c==null){c=0}if(this.isWritingModeReady){return"width:"+b+"px;height:"+a+"px;"+((c)?((!d)?"padding-bottom:":"margin-bottom:")+c+"px;":"")+((!d)?"position:relative;overflow:auto;overflow-x:auto;overflow-y:hidden;":"")}else{return"width:"+a+"px;height:"+b+"px;margin-top:-"+b+"px;margin-right:"+(b-a-c)+"px;margin-bottom:"+(a+c)+"px;margin-left:0;"+((!d)?"padding-right:"+c+"px;overflow:auto;overflow-x:visible;overflow-y:auto;":"")}},toVertical:function(e,f){if(this.isLegacy){return this}var c=this;if(e==null||e){this.setOnLoad(function(){c.toVertical(false)})}else{this.importCSS();var a=false;var h=false;if(!this.targetElements){if(!this.config.elements||this.config.elements[0]=="=auto"){this.targetElements=this.japaneseReadableElements((this.config.minScore==null)?3:this.config.minScore);this.config.togglable=false;a=true}else{if(this.config.elements[0]=="=dblclick"){h=a=true}else{var g=this.document.element(this.config.elements).list();this.targetElements=new Array();for(var d=0;d<g.length;d++){if(!this.isVerticalTextElement(g[d])){this.targetElements[this.targetElements.length]=g[d]}}}}}if(a){if(!this.toggleEventAttached){this.document.element(document.body).addEventListener("dblclick",function(i){c.toggle(c.lookUpBlockElements(i.target||event.target||event.srcElement));c.document.stopPropagation(i);c.document.preventDefault(i)});this.toggleEventAttached=true}if(h){var j=navigator.browserLanguage||navigator.language||navigator.userLanguage;j=(j.search(/tw/i)!=-1)?"zh-tw":(j.search(/(zh|cn)/i)!=-1)?"zh-cn":(j.search(/(ko|kr)/i)!=-1)?"ko-kr":"ja-jp";alert(TaketoriDblClickAlert[j]);return this}}if(this.ttbDisabled==null){this.ttbDisabled=(this.getCookie("TTB_DISABLED")=="true")?true:false}if(this.config.togglable){if(!this.config.cookieDomain){this.config.cookieDomain=document.domain}if(!this.config.cookiePath){this.config.cookiePath="/"}for(var d=0;d<this.targetElements.length;d++){var b=this.targetElements[d];if(!b.taketori){b.taketori={}}if(!b.taketori.toggleEventAttached){this.document.element(b).addEventListener("dblclick",function(i){c.document.stopPropagation(i);c.document.preventDefault(i);if(c.ttbDisabled){c.deleteCookie("TTB_DISABLED");c.ttbDisabled=false}else{c.setCookie("TTB_DISABLED","true");c.ttbDisabled=true}c.toVertical(false)});b.taketori.toggleEventAttached=true}this.toggle(b,this.ttbDisabled,true)}}else{if(!this.ttbDisabled){for(var d=0;d<this.targetElements.length;d++){this.make(this.targetElements[d])}}}}return this},configClone:function(b){if(!b){return{}}var d={};var a=["width","height","fontFamily","maxHeight","multiColumnEnabled","gap","contentWidth","contentHeight","onbreak","classNameImported","lang"];for(var c=0;c<a.length;c++){if(b[a[c]]!=null){d[a[c]]=b[a[c]]}}return d},toggleAll:function(){if(this.isLegacy){return this}if(!this.config.cookieDomain){this.config.cookieDomain=document.domain}if(!this.config.cookiePath){this.config.cookiePath="/"}if(this.ttbDisabled){this.deleteCookie("TTB_DISABLED");this.ttbDisabled=false}else{this.setCookie("TTB_DISABLED","true");this.ttbDisabled=true}for(var b=0;b<this.targetElements.length;b++){var a=this.targetElements[b];this.toggle(a,this.ttbDisabled,true)}return this},clearAll:function(){if(this.isLegacy){return this}if(!this.config.cookieDomain){this.config.cookieDomain=document.domain}if(!this.config.cookiePath){this.config.cookiePath="/"}if(!this.ttbDisabled){this.setCookie("TTB_DISABLED","true");this.ttbDisabled=true}for(var b=0;b<this.targetElements.length;b++){var a=this.targetElements[b];this.toggle(a,true,true,true)}return this},appendTarget:function(a){if(this.isVerticalTextElement(a)){return}if(!this.targetElements){this.targetElements=new Array(a)}else{if(!this.isIncludedIn(this.targetElements,a)){this.targetElements[this.targetElements.length]=a}}},removeTarget:function(c){if(this.targetElements){var a=new Array();for(var b=0;b<this.targetElements.length;b++){if(this.targetElements[b]!=c){a[a.length]=this.targetElements[b]}}this.targetElements=a}},makeClipboard:function(a,c){if(!c&&!this.process.isBreakable){return}if(this.clipboard&&this.clipboard.parentNode!=a){this.removeClipboard()}if(!this.clipboard){this.clipboard=document.createElement("div");this.clipboard.style.position="absolute";a.appendChild(this.clipboard);var b=(this.windowWidth>this.windowHeight)?this.windowWidth:this.windowHeight;this.clipboard.style.top="-"+(b+100)+"px";this.clipboard.style.left="-"+(b+100)+"px";this.clipboard.style.width=b+"px";this.clipboard.style.height=b+"px";this.clipboard.style.overflow="auto"}},removeClipboard:function(){if(this.temporaryContent){this.temporaryContent.parentNode.removeChild(this.temporaryContent)}if(this.clipboard){this.clipboard.parentNode.removeChild(this.clipboard)}this.clipboard=null;this.temporaryContent=null},toPx:function(c,b,a,d){return(!c)?0:(a)?((c.search(/(\d+\.\d+)/)!=-1)?parseInt(RegExp.$1*b):parseInt(1.5*b)):(c.search(/\d+\.?\d*em/i)!=-1)?parseInt(parseFloat(c)*b):(c.search(/\d+\.?\d*%/)!=-1)?parseInt(parseFloat(c)*((d)?d:b)/100):(c.search(/\d/)!=-1)?parseInt(c):c},getFontSize:function(a){if(!isNaN(a)||a.search(/\d+px/)!=-1){return parseInt(a)}else{var b=(this.getStyle(document.body)).fontSize;b=(b.search(/\d+\.?\d*(em|%)/)!=-1)?this.toPx(b,16):parseInt(b);a=this.toPx(a,b);return(a>0)?a:16}},setCurrentConfig:function(c,f){if(!f){f=this.configClone(this.config)}if(!f.classNameImported){var j=c.className;if(j){var b=["width","height","fontFamily","maxHeight","multiColumnEnabled","gap","contentWidth","contentHeight","lang"];for(var d=0;d<b.length;d++){var g=new RegExp("(^|\\s)taketori-"+b[d]+"-([\\w\\.\\-\\%]+)(?![\\w\\-])","i");if(j.search(g)!=-1){f[b[d]]=RegExp.$2}}}f.classNameImported=true}f.lang=(f.lang)?f.lang.toLowerCase():TaketoriDefaultLang;this.init();var o=this.getStyle(c);var n=this.getFontSize(o.fontSize);this.process={target:c,done:false,isMultiColumnEnabled:false,noCJK:0,latin:0,width:0,columnCount:0,openTagsHTML:"",listStart:[],listStyleType:[],currentStyle:{},openTags:[],closeTags:[],columnHTML:"",content:"",config:{}};if((typeof f.multiColumnEnabled=="boolean"&&f.multiColumnEnabled)||(this.isMultiColumnReady&&f.multiColumnEnabled&&f.multiColumnEnabled=="auto")){this.process.config.multiColumnEnabled=true}if(this.isMultiColumnReady&&this.process.config.multiColumnEnabled){this.process.isMultiColumnEnabled=true}if((!this.isMultiColumnReady&&this.process.config.multiColumnEnabled)||(f.contentHeight&&f.contentWidth)){this.process.isBreakable=true}var l=this.getElementWidth(c,o);if(f.contentWidth){this.process.config.contentWidth=this.toPx(f.contentWidth,n,false,l)}if(f.contentHeight){this.process.config.contentHeight=this.toPx(f.contentHeight,n,false,l)}this.process.config.width=(f.width)?this.toPx(f.width,n,false,l):(this.process.config.contentWidth!=null)?this.process.config.contentWidth:l;this.process.config.gap=(f.gap!=null)?this.toPx(f.gap,n):n*2;if(f.height==null){if(!f.maxHeight){f.maxHeight="36em"}var m=this.toPx(f.maxHeight,n);var k=(this.process.config.contentHeight)?this.process.config.contentHeight:this.windowHeight;if(this.process.config.multiColumnEnabled){var a=Math.ceil(k/(m+this.process.config.gap));this.process.config.height=parseInt((k-40)/a)-this.process.config.gap;if(this.process.config.contentHeight){this.process.config.columnCount=a}}else{k=k-this.process.config.gap-18;this.process.config.height=(k>m)?m:k}}else{if(this.process.config.contentHeight&&this.process.config.multiColumnEnabled){var e=this.toPx(f.height,n);this.process.config.columnCount=Math.ceil(this.process.config.contentHeight/(e+this.process.config.gap));this.process.config.height=parseInt((this.process.config.contentHeight+this.process.config.gap)/this.process.config.columnCount)-this.process.config.gap}else{if(f.height&&f.height=="width"){this.process.config.height=this.process.config.width}else{if(!this.process.config.multiColumnEnabled){this.process.config.height=this.process.config.contentHeight||this.toPx(f.height,n)}else{this.process.config.height=this.toPx(f.height,n)}}}}this.process.currentConfig=f;return this},getElementWidth:function(a,b){return((a.offsetWidth)?a.offsetWidth:a.scrollWidth)-this.getMarginSize([b.paddingLeft,b.paddingRight,b.borderLeftWidth,b.borderRightWidth])},getMarginSize:function(a){var c=0;for(var b=0;b<a.length;b++){if(a[b]&&!isNaN(parseInt(a[b]))){c+=parseInt(a[b])}}return c},getWidth:function(b){var a=0;this.setTaketoriClassName(this.clipboard);if(!this.temporaryContent){this.temporaryContent=document.createElement("div");this.setTemporaryContentStyle();this.clipboard.appendChild(this.temporaryContent)}this.temporaryContent.innerHTML=b;this.process.width=this.getTemporaryContentWidth();this.clipboard.className="";return this.process.width},setTemporaryContentStyle:function(){this.temporaryContent.className="taketori-col";if(this.isWritingModeReady){this.temporaryContent.style.height=this.process.config.height+"px";this.temporaryContent.style.width="16px"}else{this.temporaryContent.style.overflow="auto";this.temporaryContent.style.width=this.process.config.height+"px"}},getTemporaryContentWidth:function(){return(this.isWritingModeReady)?(this.temporaryContent.scrollWidth||this.temporaryContent.clientWidth||this.temporaryContent.offsetWidth):(this.temporaryContent.scrollHeight||this.temporaryContent.clientHeight||this.temporaryContent.offsetHeight)},hasToBreak:function(d){if(!this.temporaryContent){this.temporaryContent=document.createElement("div");this.clipboard.appendChild(this.temporaryContent)}var a=0;var c=0;var b=false;this.temporaryContent.className="taketori-col";this.temporaryContent.style.overflow="auto";this.setTaketoriClassName(this.clipboard);if(this.process.config.columnCount&&this.process.config.columnCount>1){var e=this.process.config.width*this.process.config.columnCount;if(this.process.width+50<e){this.setTemporaryContentStyle();this.temporaryContent.innerHTML=d;this.process.width=this.getTemporaryContentWidth()}if(this.process.width+50>=e){a=this.getMultiColumnWidth(d);b=(a>this.process.config.contentHeight)?true:false}}else{if(this.isWritingModeReady){this.temporaryContent.style.height=this.process.config.contentHeight+"px";this.temporaryContent.innerHTML=d;this.process.width=this.temporaryContent.scrollWidth||this.temporaryContent.clientWidth||this.temporaryContent.offsetWidth;b=(this.process.width>this.process.config.contentWidth)?true:false}else{this.temporaryContent.style.width=this.process.config.contentHeight+"px";this.temporaryContent.innerHTML=d;this.process.width=this.temporaryContent.scrollHeight||this.temporaryContent.clientHeight||this.temporaryContent.offsetHeight;b=(this.process.width>this.process.config.contentWidth)?true:false}}this.clipboard.className="";return b},getMultiColumnWidth:function(b){if(!this.temporaryContent){this.temporaryContent=document.createElement("div");this.clipboard.appendChild(this.temporaryContent)}var a=0;this.setTaketoriClassName(this.clipboard);this.setMultiColumnStyle(this.temporaryContent);this.temporaryContent.innerHTML=b;a=(this.isWritingModeReady)?this.getTotalHeight(this.temporaryContent):this.getTotalWidth(this.temporaryContent);this.clipboard.className="";return a},setMultiColumnStyle:function(a){a.className="taketori-col taketori-multi-column";a.style.overflow="auto";if(this.isWritingModeReady){a.style.width=this.process.config.width+"px";a.style.height=this.process.config.height+"px"}else{a.style.width=this.process.config.height+"px";a.style.height=this.process.config.width+"px"}a.style.MozColumnWidth=this.process.config.height+"px";a.style.webkitColumnWidth=this.process.config.height+"px";a.style.OColumnWidth=this.process.config.height+"px";a.style.columnWidth=this.process.config.height+"px";a.style.MozColumnGap=this.process.config.gap+"px";a.style.webkitColumnGap=this.process.config.gap+"px";a.style.OColumnGap=this.process.config.gap+"px";a.style.columnGap=this.process.config.gap+"px"},setMultiColumnWidth:function(b){if(this.isWritingModeReady){var c=this.getTotalHeight(b);b.style.height=c+"px";b.style.overflow="visible";this.fixMargin(b,this.process.config.width,c)}else{var a=this.getTotalWidth(b);b.style.width=a+"px";b.style.overflow="visible";this.fixMargin(b,a,this.process.config.width)}},getTotalWidth:function(b){var a=b.scrollWidth||b.clientWidth||b.offsetWidth;return Math.ceil(a/(this.process.config.height+this.process.config.gap))*(this.process.config.height+this.process.config.gap)-this.process.config.gap},getTotalHeight:function(a){var b=a.scrollHeight||a.clientHeight||a.offsetHeight;return Math.ceil(b/(this.process.config.height+this.process.config.gap))*(this.process.config.height+this.process.config.gap)-this.process.config.gap},setTaketoriClassName:function(a){var b=(this.isWritingModeReady)?"taketori-writingmode-ttb":"taketori-ttb";if(this.rubyDisabled){b+=" taketori-ruby-disabled"}if(!this.isTextEmphasisReady){b+=" taketori-text-emphasis-disabled"}b+=((this.isWritingModeReady&&navigator.userAgent.search(/WebKit/i)!=-1&&navigator.userAgent.search(/Windows/i)!=-1)?" taketori-atsign":(!this.process.currentConfig.fontFamily)?" taketori-serif":(this.process.currentConfig.fontFamily=="sans-serif")?" taketori-sans-serif":(this.process.currentConfig.fontFamily=="cursive")?" taketori-cursive":(this.process.currentConfig.fontFamily=="kai")?" taketori-kai":" taketori-serif")+"-"+this.process.currentConfig.lang;b+=" taketori-lang-"+this.process.currentConfig.lang;a.className+=((a.className)?" ":"")+b},removeTaketoriClassName:function(a){this.document.element(a).removeClassName("taketori-ttb").removeClassName("taketori-writingmode-ttb").removeClassName("taketori-ruby-disabled").removeClassName("taketori-(lang|serif|sans-serif|cursive|kai)[\\w\\-]*")},make:function(a,c){this.document.element(a).addClassName("taketori-in-progress");var b=this;setTimeout(function(){if(!c){b.setCurrentConfig(a)}b.makeClipboard(a);b.parse(a,true);b.complement(a);b.removeClipboard();b.document.element(a).removeClassName("taketori-in-progress")},120)},isSkipClass:function(b){if(this.config.skipClass&&b.className){for(var a=0;a<this.config.skipClass.length;a++){var c=new RegExp("(^|\\s)"+this.config.skipClass[a]+"(?![\\w\\-])");if(this.elements.className.search(c)!=-1){return true}}}return false},isSkipId:function(a){return(this.config.skipId&&a.id&&this.isIncludedIn(this.config.skipId,thisNode.id))?true:false},parse:function(n,v){if(n==this.clipboard){return}if(n.taketori&&n.taketori.ttb){this.toggle(n,true,true)}var C=n.nodeName.toLowerCase();var p="";var m="";var h="";var B="";var a="";var o="";var y=false;var d=n.nodeType;var z=null;var A=false;var c=n.hasChildNodes&&n.hasChildNodes();switch(d){case 1:var e=this.getStyle(n);if(this.process.isBreakable){var b=this.getFontSize(e.fontSize);this.process.lineHeight=this.toPx(e.lineHeight,b,true);if(!this.process.lineLength){this.process.lineLength=this.process.config.height}if(!v&&e.display=="block"){var g=this.process.lineLength;this.process.lineLength-=this.getMarginSize([e.marginTop,e.marginBottom,e.paddingTop,e.paddingBottom,e.borderTopWidth,e.borderBottomWidth]);if(this.process.lineLength<b){this.process.lineLength=b}}this.process.roughFormula=b*this.process.lineHeight/this.process.lineLength}if(!v){if(this.isIncludedIn(["img","object","embed","video","audio","textarea"],C)){this.appendHTML(this.counterClockwiseRotatedOuterHTML(n,e));return}else{if(this.isSkipClass(n)||this.isSkipId(n)){this.appendHTML(this.counterClockwiseRotatedOuterHTML(n,e));return}else{if(this.isIncludedIn(["link","meta","base","script","style","map"],C)){this.process.columnHTML+=this.outerHTML(n);return}else{if(C=="!"){return}else{if(this.isIncludedIn(["br","input","select","option"],C)||(this.isMSIE&&this.isMSIE<8&&C=="table")){this.appendHTML(this.outerHTML(n));return}}}}}var l=n.attributes;var x=false;var t=false;for(var w=0;w<l.length;w++){var r=l[w];var q=r.nodeName.toLowerCase();var f=(typeof r.nodeValue=="string"||typeof r.nodeValue=="number")?this.escapeHTML(r.nodeValue):(q=="style"&&n.style.cssText!=null)?n.style.cssText.replace(/[\w\-]+:/g,function(i){return i.toLowerCase()}):(q=="class"&&n.className!=null)?n.className:null;if(!r.specified||!f||this.isIncludedIn(this.stripAttributes,q)){continue}switch(q){case"style":B=f;f="";break;case"class":a+=((a)?" ":"")+f;if(f.search(/(^|\s)ltr(?![\w\-])/)!=-1){if(!this.process.ltr){x=true}this.process.ltr=true}f="";break;case"dir":if(f.search(/(^|\s)ltr(?![\w\-])/)!=-1){if(!this.process.ltr){x=true}this.process.ltr=true}a+=((a)?" ":"")+f;break}if(f!=null&&f!=""){h+=" "+q+'="'+f+'"'}}if(x){B+=this.counterClockwiseRotatedOuterHTML(n,e,true)}else{if(this.isWritingModeReady&&!this.isIncludedIn(["table","caption","thead","tbody","tr","td","th","tfoot"],C)){B+=this.counterClockwiseRotatedOuterHTML(n,e,true)}}if(!this.process.ltr&&(!this.isMSIE||this.isMSIE>7)){if(C=="li"&&this.process.listStyleType&&this.process.listStyleType[this.process.listStyleType.length-1]!=""){h+=' data-marker="'+this.getListMarkerText()+'"'}if(C=="ul"||C=="ol"){y=true;this.process.listStart[this.process.listStart.length]=0;var s=e.listStyleType.toLowerCase();if(this.isIncludedIn(["none","disc","circle","square"],s)){this.process.listStyleType[this.process.listStyleType.length]=""}else{this.process.listStyleType[this.process.listStyleType.length]=s;a+=((a)?" ":"")+"cjk"}}if(this.isWritingModeReady){if(C=="strong"){if(!this.isTextEmphasisReady){if(!this.process.kenten){t=true}this.process.kenten=true}a+=((a)?" ":"")+"bo-ten"}}if(!this.isWritingModeReady&&e.fontStyle&&e.fontStyle.toLowerCase()=="italic"&&c){a+=((a)?" ":"")+"italic"}if(e.textDecoration&&c){var u=e.textDecoration.toLowerCase();if(u!="none"){if(u.search(/underline/i)!=-1&&u.search(/overline/i)!=-1){a+=((a)?" ":"")+"bothline";z=this.lineMarginHeight(e)}else{if(u.search(/underline/i)!=-1){a+=((a)?" ":"")+"underline";z=this.lineMarginHeight(e)}else{if(u.search(/overline/i)!=-1){a+=((a)?" ":"")+"overline";z=this.lineMarginHeight(e)}}}if(!this.isWritingModeReady&&z){if(!this.process.lineMarginHeight){A=true}this.process.lineMarginHeight=z}}}}if(a){h+=' class="'+a+'"'}if(B){h+=' style="'+B+'"'}if(!v){p+="<"+C+h}}if(!c){if(!v){p+="></"+C+">";this.process.columnHTML+=p}}else{if(!v){this.process.columnHTML+=p+">";if(y){p+=' start=""'}p+=">";m="</"+C+">";this.process.openTags[this.process.openTags.length]=p;this.process.closeTags[this.process.closeTags.length]=C}for(var w=0;w<n.childNodes.length;w++){this.parse(n.childNodes[w])}if(!v){this.process.columnHTML+=m;this.process.openTags.pop();this.process.closeTags.pop();if(x){this.process.ltr=null}if(t){this.process.kenten=null}if(A){this.process.lineMarginHeight=null}if(y){this.process.listStart.pop();this.process.listStyleType.pop()}}}if(g){this.process.lineLength=g}break;case 3:o=this.escapeHTML(n.nodeValue);o=o.replace(/\uFF0F\uFF3C/g,"\u3033\u3035").replace(/\uFF3C\uFF0F/g,"\u3033\u3035").replace(/\uFF0F\u0022\uFF3C/g,"\u3034\u3035").replace(/\uFF3C\u0022\uFF0F/g,"\u3034\u3035");var k=this;var j=0;o.replace(/&#?\w+;|\s+|./g,function(i){if(i.search(/^[\u1100-\u11FF\u2030-\u217F\u2460-\u24FF\u2600-\u261B\u2620-\u277F\u2E80-\u2FDF\u2FF0-\u4DBF\u4E00-\u9FFF\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF\uF900-\uFAFF\uFE30-\uFE4F\uFF00\uFF01\uFF03-\uFF06\uFF08-\uFF0C\uFF0E-\uFF1B\uFF1F-\uFF3D\uFF40-\uFF5B\uFF5D-\uFFEF]$/)!=-1){k.setCJK();if((!k.isWritingModeReady||k.process.kenten)&&!k.process.ltr){i=k.kinsokuShori("<span"+((!k.process.ltr)?' class="'+k.getCJKClassName(i)+'"':"")+((!k.process.ltr&&k.process.lineMarginHeight)?' style="margin-top:'+k.process.lineMarginHeight+"px;margin-bottom:"+k.process.lineMarginHeight+'px;"':"")+">"+i+"</span>")}j++}else{if(i.search(/^\s+$/)!=-1){if(j>0){j+=0.5}}else{if(i.search(/^[0-9a-zA-Z]$/)!=-1){j+=0.5;k.process.latin++}else{j++;k.process.latin=0}if(k.process.noCJK==0){i='<span class="nocjk notcy">'+i}if(!this.isTextEmphasisReady){k.process.noCJK++}}}if(!k.process.isBreakable||(j>1&&k.isNoBreak(k.process.width+(j*k.process.roughFormula)+k.process.lineHeight))){k.process.columnHTML+=i}else{j=1;k.appendHTML(i)}});this.setCJK();break}},isNoBreak:function(a){if(this.isWritingModeReady||!this.process.isMultiColumnEnabled){return(a<this.process.config.width)?true:false}else{if(this.process.config.contentHeight&&this.process.config.contentWidth){if(this.process.config.columnCount&&this.process.config.columnCount>1){return(a+50<this.process.config.width*this.process.config.columnCount)?true:false}else{return(a<this.process.config.contentHeight)?true:false}}else{return true}}},setCJK:function(){if(this.process.noCJK>0){this.process.columnHTML=((this.process.noCJK==this.process.latin&&this.process.latin<=2)?this.process.columnHTML.replace('<span class="nocjk notcy">','<span class="tcy">'):this.process.columnHTML.replace('<span class="nocjk notcy">','<span class="nocjk">'))+"</span>"}this.process.latin=this.process.noCJK=0},lineMarginHeight:function(a){var b=a.lineHeight;var c=this.getFontSize(a.fontSize);if(b.search(/\d+px/)!=-1){return parseInt((parseInt(b)-c)/2)}else{return parseInt((parseFloat(b)*c-c)/2)}},getListMarkerText:function(){var c=++this.process.listStart[this.process.listStart.length-1];var a=this.process.listStyleType[this.process.listStyleType.length-1];var b;if(a=="A"||a=="\u30A2"||a=="upper-latin"||a=="katakana"){b=["\u30A2","\u30A2","\u30A4","\u30A6","\u30A8","\u30AA","\u30AB","\u30AD","\u30AF","\u30B1","\u30B3","\u30B5","\u30B7","\u30B9","\u30BB","\u30BD","\u30BF","\u30C1","\u30C4","\u30C6","\u30C8","\u30CA","\u30CB","\u30CC","\u30CD","\u30CE","\u30CF","\u30D2","\u30D5","\u30D8","\u30DB","\u30DE","\u30DF","\u30E0","\u30E1","\u30E2","\u30E4","\u30E6","\u30E8","\u30E9","\u30EA","\u30EB","\u30EC","\u30ED","\u30EF","\u30F0","\u30F1","\u30F2","\u30F3"];return"("+b[c]+")"}else{if(a=="a"||a=="\u3042"||a=="lower-latin"||a=="hiragana"){b=["\u3042","\u3042","\u3044","\u3046","\u3048","\u304A","\u304B","\u304D","\u304F","\u3051","\u3053","\u3055","\u3057","\u3059","\u305B","\u305D","\u305F","\u3061","\u3064","\u3066","\u3068","\u306A","\u306B","\u306C","\u306D","\u306E","\u306F","\u3072","\u3075","\u3078","\u307B","\u307E","\u307F","\u3080","\u3081","\u3082","\u3084","\u3086","\u3088","\u3089","\u308A","\u308B","\u308C","\u308D","\u308F","\u3090","\u3091","\u3092","\u3093"];return"("+b[c]+")"}else{if(a=="\u30A4"||a=="katakana-iroha"){b=["\u30A4","\u30A4","\u30ED","\u30CF","\u30CB","\u30DB","\u30D8","\u30C8","\u30C1","\u30EA","\u30CC","\u30EB","\u30F2","\u30EF","\u30AB","\u30E8","\u30BF","\u30EC","\u30BD","\u30C4","\u30CD","\u30CA","\u30E9","\u30E0","\u30A6","\u30F0","\u30CE","\u30AA","\u30AF","\u30E4","\u30DE","\u30B1","\u30D5","\u30B3","\u30A8","\u30C6","\u30A2","\u30B5","\u30AD","\u30E6","\u30E1","\u30DF","\u30B7","\u30F1","\u30D2","\u30E2","\u30BB","\u30B9"];return"("+b[c]+")"}else{if(a=="\u3044"||a=="hiragana-iroha"){b=["\u3044","\u3044","\u308D","\u306F","\u306B","\u307B","\u3078","\u3068","\u3061","\u308A","\u306C","\u308B","\u3092","\u308F","\u304B","\u3088","\u305F","\u308C","\u305D","\u3064","\u306D","\u306A","\u3089","\u3080","\u3046","\u3090","\u306E","\u304A","\u304F","\u3084","\u307E","\u3051","\u3075","\u3053","\u3048","\u3066","\u3042","\u3055","\u304D","\u3086","\u3081","\u307F","\u3057","\u3091","\u3072","\u3082","\u305B","\u3059"];return"("+b[c]+")"}else{if(a=="I"||a=="upper-roman"){b=["I","I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX"];return"("+b[c]+")"}else{if(a=="i"||a=="lower-roman"){b=["i","i","ii","iii","iv","v","vi","vii","viii","ix","x","xi","xii","xiii","xiv","xv","xvi","xvii","xviii","xix","xx"];return"("+b[c]+")"}else{if(a=="1"||a=="decimal"||a=="\u4E00"||a=="cjk-ideographic"||a=="\u58F1"){if(c<=10){b=(a=="\u58F1")?["\u58F1","\u58F1","\u5F10","\u53C2","\u56DB","\u4F0D","\u516D","\u4E03","\u516B","\u4E5D","\u62FE"]:["\u4E00","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D","\u4E03","\u516B","\u4E5D","\u5341"];return"("+b[c]+")"}else{return"("+c+")"}}else{return""}}}}}}}},appendHTML:function(a,c){var b="";if(a==null){a=""}if((c||this.process.isBreakable)&&this.process.columnHTML!=""){if((this.isWritingModeReady&&!this.isMultiColumnReady)||!this.process.isMultiColumnEnabled){if(c){b=this.columnComplement()}else{b=this.columnComplement(this.process.columnHTML+a)}if(c||this.process.config.width<this.getWidth(b)){if(!c){b=this.columnComplement()}this.process.content+='<div class="taketori-col" style="'+this.rotatedBlockAdditionalCSSText(this.process.config.height,this.process.config.width,this.process.config.gap,this.process.config.multiColumnEnabled)+'">'+b+"</div>";this.process.columnCount++;if(c||(this.process.config.columnCount&&this.process.config.columnCount==this.process.columnCount)){this.containerBreak()}}}else{if(this.process.config.contentHeight&&this.process.config.contentWidth){if(c){b=this.columnComplement()}else{b=this.columnComplement(this.process.columnHTML+a)}if(c||this.hasToBreak(b)){if(!c){b=this.columnComplement()}if(this.process.config.columnCount&&this.process.config.columnCount>1){this.process.content+='<div class="taketori-col taketori-multi-column" style="-moz-column-width:'+this.process.config.height+"px;-webkit-column-width:"+this.process.config.height+"px;column-width:"+this.process.config.height+"px;-moz-column-count:"+this.process.config.columnCount+";-webkit-column-count:"+this.process.config.columnCount+";column-count:"+this.process.config.columnCount+";-moz-column-gap:"+this.process.config.gap+"px;-webkit-column-gap:"+this.process.config.gap+"px;column-gap:"+this.process.config.gap+"px;"+this.rotatedBlockAdditionalCSSText(this.process.config.contentHeight,this.process.config.contentWidth,0,true)+'">'+b+"</div>"}else{this.process.content+='<div class="taketori-col" style="'+this.rotatedBlockAdditionalCSSText(this.process.config.contentHeight,this.process.config.contentWidth)+'">'+b+"</div>"}this.containerBreak()}}else{if(c){this.process.content=document.createElement("div");this.setMultiColumnStyle(this.process.content);this.process.content.innerHTML=this.columnComplement();this.containerBreak();this.setMultiColumnWidth(this.process.target.firstChild)}}}}this.process.columnHTML+=a},columnComplement:function(a){var j=false;var d="";if(a==null){d=this.process.columnHTML+((this.process.noCJK>1)?"</span>":"");j=true}else{d=a+((this.process.noCJK)?"</span>":"")}if(j){this.process.columnHTML="";this.process.width=0;if(this.process.noCJK){this.process.noCJK=1}if(this.process.latin){this.process.latin=1}}var b="";var e=this.process.openTagsHTML;var h=true;for(var c=this.process.closeTags.length-1;c>=0;c--){var f=this.process.closeTags[c];var g=new RegExp("<"+f+"(?!\\w)[^>]*>\\s*$");if(d.search(g)==-1){b+="</"+f+">"}else{if(b==""){d=d.replace(g,"");if(f=="li"){h=false}}}}if(j){this.process.openTagsHTML=this.process.openTags.join("");if(h){this.process.openTagsHTML=this.process.openTagsHTML.replace(/ data-marker=".*?"/g,"")}for(var c=0;c<this.process.listStart.length;c++){this.process.openTagsHTML=this.process.openTagsHTML.replace(/ start=""/,'start="'+this.process.listStart[c]+'"')}}return e+d+b},getCJKClassName:function(a){var b;if(a=="\u30FC"||a=="\u301C"||a=="\uFF5E"||a=="\u2026"){this.process.kinsoku=true;return"cjk cho-on"}else{if(a=="\u3001"||a=="\uFF0C"){this.process.kinsoku=true;return(this.process.currentConfig.lang=="ja-jp")?"cjk tou-ten":"cjk"}else{if(a=="\u3002"||a=="\uFF0E"){this.process.kinsoku=true;return(this.process.currentConfig.lang=="ja-jp")?"cjk ku-ten":"cjk"}else{if(a.search(/^[\u3041\u3043\u3045\u3047\u3049\u3083\u3085\u3087\u3063\u30A1\u30A3\u30A5\u30A7\u30A9\u30E3\u30E5\u30E7\u30C3]$/)!=-1){this.process.kinsoku=true;return"cjk kogaki"}else{if(a.search(/^[\u3009\u300B\u300D\u300F\u3011\u3015\u3017\u3019\uFF09\uFF5D\uFF60]$/)!=-1){this.process.kinsoku=true;return"kakko"}else{if(a.search(/^[\u3008\u300A\u300C\u300E\u3010\u3014\u3015\u3018\uFF08\uFF5B\uFF5F]$/)!=-1){return"kakko"}else{if(a.search(/^[\uFF01\uFF1A\uFF1B\uFF1F]$/)!=-1){this.process.kinsoku=true;return"cjk"}else{return"cjk"}}}}}}}},kinsokuShori:function(a){if(this.process.kinsoku){this.process.columnHTML=this.process.columnHTML.replace(/(<span(?!\w)[^>]*class="cjk"[^>]*>.<\/span>)$/,"");if(RegExp.$1){a='<span class="kinsoku">'+RegExp.$1+a+"</span>"}this.process.kinsoku=null}return a},complement:function(a){this.appendHTML("",true)},containerBreak:function(){if(typeof this.process.config.onbreak=="function"){this.process.config.onbreak(this)}else{this._containerBreak()}},_containerBreak:function(){if(this.process.target){this.removeClipboard();if(!this.process.target.taketori){this.process.target.taketori={}}if(!this.process.config.contentWidth||!this.process.config.contentHeight||!this.process.done){var e=this.process.target.innerHTML;this.setTaketoriClassName(this.process.target);if(typeof this.process.content=="object"){this.process.target.innerHTML="";this.process.target.appendChild(this.process.content)}else{this.process.target.innerHTML=this.process.content;var b=this.process.target.firstChild;var d=this;var a=this.process.config.width;var c=this.process.config.gap;setTimeout(function(){if(d.isWritingModeReady){if(b.clientHeight<b.scrollHeight){b.style.height=b.scrollHeight+"px"}}else{if(b.clientWidth<b.scrollWidth){var f=b.scrollWidth;b.style.width=f+"px";d.fixMargin(b,f,a,c,d.process.config.multiColumnEnabled)}}},600)}if(this.process.config.contentWidth&&this.process.config.contentHeight){this.process.done=true}this.process.content="";this.process.target.taketori.ttb=true;this.process.target.taketori.alt=e;this.process.target.taketori.config=this.configClone(this.process.currentConfig);this.process.target.taketori.clientWidth=this.process.target.clientWidth;this.process.target.taketori.windowHeight=this.windowHeight}this.makeClipboard(this.process.target)}},fixMargin:function(d,a,b,c,e){if(!c){c=0}if(this.isWritingModeReady){if(c){if(!e){d.style.paddingBottom=c+"px"}else{d.style.marginBottom=c+"px"}}}else{d.style.marginTop="-"+b+"px";d.style.marginRight=(b-a-c)+"px";d.style.marginBottom=(a+c)+"px";d.style.marginLeft=0;if(!e&&c){d.style.paddingRight=c+"px"}}},refresh:function(){if(this.isLegacy){return this}this.init();for(var c=0;c<this.targetElements.length;c++){var b=this.targetElements[c];if(b&&b.taketori&&b.taketori.alt&&b.taketori.ttb&&(b.clientWidth!=b.taketori.clientWidth||b.taketori.windowHeight!=this.windowHeight)){this.setCurrentConfig(b,b.taketori.config);if(this.process.isBreakable){this.toggle(b,true,true);this.make(b,true)}else{var d=b.firstChild;var a;if(d){if(this.process.isMultiColumnEnabled){d.style.overflow="auto"}if(b.clientWidth!=b.taketori.clientWidth){b.taketori.clientWidth=b.clientWidth;if(this.isWritingModeReady){d.style.width=this.process.config.width+"px"}else{d.style.height=this.process.config.width+"px"}}if(b.taketori.windowHeight!=this.windowHeight){if(this.process.isMultiColumnEnabled){a=this.process.config.height;d.style.MozColumnWidth=a+"px";d.style.webkitColumnWidth=a+"px";d.style.OColumnWidth=a+"px";d.style.columnWidth=a+"px"}else{if(this.isWritingModeReady){d.style.height=this.process.config.height+"px";if(d.clientHeight<d.scrollHeight){d.style.height=d.scrollHeight+"px"}}else{a=this.process.config.height;d.style.width=a+"px";if(d.clientWidth<d.scrollWidth){a=d.scrollWidth;d.style.width=a+"px"}}}b.taketori.windowHeight=this.windowHeight}if(this.process.isMultiColumnEnabled){if(this.isWritingModeReady){d.style.height=this.process.config.height+"px"}else{d.style.width=this.process.config.height+"px"}this.setMultiColumnWidth(d)}else{if(!this.isWritingModeReady){this.fixMargin(d,a,this.process.config.width,this.process.config.gap,this.process.config.multiColumnEnabled)}}}}}}},toggle:function(b,a,c,e){if(this.isLegacy||this.isVerticalTextElement(b)||(a!=null&&((a&&(!b.taketori||!b.taketori.ttb))||((!a&&b.taketori&&b.taketori.ttb))))){return this}this.init();if(b.taketori&&b.taketori.alt&&(b.taketori.ttb||(b.clientWidth==b.taketori.clientWidth&&b.taketori.windowHeight==this.windowHeight))){var d=b.innerHTML;b.innerHTML=b.taketori.alt;if(b.taketori.ttb){this.removeTaketoriClassName(b)}else{this.setTaketoriClassName(b);c=true}if(c){b.taketori.alt=((e||this.config.cacheDisabled)&&b.taketori.ttb)?null:d;b.taketori.ttb=(b.taketori.ttb)?false:true;b.taketori.clientWidth=b.clientWidth;b.taketori.windowHeight=this.windowHeight}else{this.removeTarget(b);b.taketori=null}}else{this.appendTarget(b);this.make(b,false)}return this},clear:function(a){this.toggle(a,true,true,true)}};